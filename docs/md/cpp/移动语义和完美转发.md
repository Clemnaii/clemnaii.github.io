ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘  
==============

---

ç§»åŠ¨è¯­ä¹‰`std::move`å’Œå®Œç¾è½¬å‘`std::forward`æ˜¯C++11çš„æ–°ç‰¹æ€§

## **ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦std::move**

æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦é€šè¿‡**ç§»åŠ¨æ„é€ **å»æ„é€ ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½†åŸå¯¹è±¡æ˜¯å·¦å€¼ï¼ˆå¦‚å˜é‡åï¼‰ï¼Œ**å·¦å€¼ä¸èƒ½è§¦å‘ç§»åŠ¨æ„é€ **ï¼Œä¼šé»˜è®¤è°ƒç”¨**æ‹·è´æ„é€ å‡½æ•°**ã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨ `std::move` æ˜ç¡®åœ°å‘Šè¯‰ç¼–è¯‘å™¨ï¼šâ€œè¿™ä¸ªå·¦å€¼ä½ å¯ä»¥å½“æˆå³å€¼ç”¨â€ã€‚

> 1.ç§»åŠ¨æ„é€ /ç§»åŠ¨èµ‹å€¼ä»¥`T&&`ä¸ºå‚æ•°(å³å€¼å¼•ç”¨), æ‹·è´æ„é€ /æ‹·è´èµ‹å€¼ä»¥`T&`ä¸ºå‚æ•°(å·¦å€¼å¼•ç”¨)
>
> 2.æ‹·è´æ„é€ /æ‹·è´èµ‹å€¼ä¸èƒ½ä»¥`T`ä¸ºå‚æ•°, å¦åˆ™åœ¨å½¢å‚ä¼ é€’è¿‡ç¨‹ä¸­ä¼šé€’å½’è°ƒç”¨æ‹·è´èµ‹å€¼, å¯¼è‡´

ğŸ‘‰ `std::move` å®é™…ä¸Šå¹¶ä¸â€œç§»åŠ¨â€ï¼Œå®ƒåªæ˜¯æŠŠä¸€ä¸ªå·¦å€¼ `T&` è½¬æ¢æˆå³å€¼å¼•ç”¨ `T&&`ï¼Œä»è€Œè§¦å‘ç§»åŠ¨æ„é€ æˆ–ç§»åŠ¨èµ‹å€¼ã€‚

> ä»£ç ç¤ºä¾‹

```clike
std::string a = "hello"; //aæ˜¯ä¸€ä¸ªå·¦å€¼
std::string b = std::move(a); //è¿™é‡Œç›¸å½“äºèµ‹å€¼"b=å³å€¼"ï¼Œè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°
```



<br>

<br>

## **äºŒã€ä¸ºä»€ä¹ˆéœ€è¦std::forward**

> 1.åœ¨æ™®é€šå‡½æ•°ä¸­, `T&`åªèƒ½æ¥æ”¶å·¦å€¼, `T&&`åªèƒ½æ¥æ”¶å³å€¼
>
> 2.åœ¨æ¨¡æ¿å‡½æ•°ä¸­, `T&&`æ˜¯ä¸‡èƒ½å¼•ç”¨, å¯ä»¥åŒæ—¶æ¥æ”¶å·¦å€¼å’Œå³å€¼

ä½†æ˜¯åœ¨æ¨¡æ¿å‡½æ•°ä¸­, æˆ‘ä»¬æ²¡åŠæ³•ç¡®å®š `T&&` æ‹¿åˆ°çš„å®å‚åŸæœ¬æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼, å¦‚æœä½ å¸Œæœ›**å°†è¿™ä¸ªå‚æ•°â€œåŸæ ·â€åœ°ï¼ˆä¿æŒå·¦å€¼æˆ–å³å€¼èº«ä»½ï¼‰è½¬å‘åˆ°å¦ä¸€ä¸ªå‡½æ•°ä¸­**ï¼Œå°±å¿…é¡»ç”¨ `std::forward`ã€‚

> ä»¥ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ä¸¾ä¾‹

```clike
template<typename T>
void wrapper(T&& arg) {
    // æ€»æ˜¯å·¦å€¼è°ƒç”¨
    func(arg); 
    // ä¿æŒå€¼ç±»åˆ«
    func(std::forward<T>(arg)); 
}
```

- æˆ‘ä»¬åœ¨å¤–éƒ¨ä¼šä»¥ `wrapper<T>()`çš„æ–¹å¼å»è°ƒç”¨è¯¥å‡½æ•°, æ‰€ä»¥å°±ä¼šç»™å‡½æ•°ä¼ å…¥ä¸€ä¸ª`T`

- æ— è®ºå¤–éƒ¨ä¼ å…¥çš„`T`æ˜¯`int, int&è¿˜æ˜¯int&&`, å½¢å‚`arg`æ­¤æ—¶éƒ½ä¼šæ˜¯ä¸€ä¸ªå·¦å€¼

- ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³åœ¨`wrapper<T>()`å†…éƒ¨æ‹¿åˆ°ä¼ å…¥çš„å®å‚çš„åŸå§‹ç±»å‹, å°±éœ€è¦é ä¼ å…¥çš„Tå»è·å–
  - æ¯”å¦‚ä¼ å…¥çš„Tå¦‚æœæ˜¯inté‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±çŸ¥é“å¤–éƒ¨åŸå§‹ç±»å‹æ˜¯å³å€¼, æ­¤æ—¶æˆ‘ä»¬å¸Œæœ›argä¹Ÿæ˜¯ä¸€ä¸ªå³å€¼
     `std::forward<T>(arg)`  -->  å°†`args`è½¬ä¸ºå³å€¼
  - æ¯”å¦‚ä¼ å…¥çš„Tå¦‚æœæ˜¯int&é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±çŸ¥é“å¤–éƒ¨åŸå§‹ç±»å‹æ˜¯å·¦å€¼, æ­¤æ—¶æˆ‘ä»¬å¸Œæœ›argä¹Ÿæ˜¯ä¸€ä¸ªå·¦å€¼
     `std::forward<T>(arg)`  -->  å°†`args`è½¬ä¸ºå·¦å€¼
  - åˆæ¯”å¦‚ä¼ å…¥çš„Tå¦‚æœæ˜¯int&&é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå°±çŸ¥é“å¤–éƒ¨åŸå§‹ç±»å‹æ˜¯å³å€¼, æ­¤æ—¶æˆ‘ä»¬å¸Œæœ›argä¹Ÿæ˜¯ä¸€ä¸ªå³å€¼
    `std::forward<T>(arg)`  -->  å°†`args`è½¬ä¸ºå³å€¼

> å®Œæ•´ä»£ç ç¤ºä¾‹

```clike
template<typename T>
void wrapper(T&& arg) {
    // æ€»æ˜¯å·¦å€¼è°ƒç”¨
    func(arg);              // æ‹·è´æ„é€ 
    // ä¿æŒå€¼ç±»åˆ«
    func(std::forward<T>(arg)); // æ‹·è´ or ç§»åŠ¨ï¼Œç”± T å†³å®š
}

void func(const std::vector<int>& v) {
    std::cout << "Calling func with a const lvalue reference\n";
}

void func(std::vector<int>&& v) {
    std::cout << "Calling func with a rvalue reference (move)\n";
}

int main() {
    std::vector<int> v = {1, 2, 3};

    std::cout << "Passing lvalue:\n";
    wrapper(v);  // ä¼ é€’å·¦å€¼

    std::cout << "\nPassing rvalue:\n";
    wrapper(std::move(v));  // ä¼ é€’å³å€¼ï¼ˆé€šè¿‡ std::moveï¼‰

    return 0;
}

```

> è¾“å‡º

```
Passing lvalue:
Calling func with a const lvalue reference
Calling func with a const lvalue reference

Passing rvalue:
Calling func with a const lvalue reference
Calling func with a rvalue reference (move)
```

